# FPS Monitor - External Mode

## 简介

这是一个**不需要注入**的 FPS 监控工具，可以在带有反作弊保护的游戏中使用。

## 原理

```
┌──────────────────────────────────┐
│       fps_monitor.exe            │
│  ┌────────────┐  ┌────────────┐ │
│  │ ETW 监控   │→ │ 透明窗口   │ │
│  │ 系统级事件 │  │ 覆盖显示   │ │
│  └────────────┘  └────────────┘ │
└──────────────────────────────────┘
         ↑ 系统事件（不接触游戏进程）
┌──────────────────────────────────┐
│      游戏进程（反作弊保护）       │
└──────────────────────────────────┘
```

**关键技术：**
- **ETW (Event Tracing for Windows)** - 系统级事件追踪，监控 DXGI Present 调用
- **透明覆盖窗口** - 独立进程，不注入游戏

## 使用方法

1. 运行 `fps_monitor.exe`（需要管理员权限）
2. 首次运行会创建 `games.txt`，添加游戏进程名
3. 程序最小化到托盘
4. 启动游戏，自动显示 FPS

## 配置文件

```
# games.txt
Brawlhalla.exe
VALORANT.exe
LeagueofLegends.exe
```

## 与注入版本的区别

| 特性 | 注入版 (fps_overlay.dll) | 外部版 (fps_monitor.exe) |
|------|--------------------------|--------------------------|
| 反作弊兼容 | ❌ 会被检测 | ✅ 完全兼容 |
| 精确度 | ⭐⭐⭐⭐⭐ 完美 | ⭐⭐⭐⭐ 很好 |
| 全屏独占 | ✅ 支持 | ⚠️ 可能不显示 |
| 窗口/无边框 | ✅ 支持 | ✅ 支持 |

## 限制

1. **全屏独占模式** - 覆盖窗口可能不会显示在游戏上方
2. **需要管理员权限** - ETW 监控需要提升权限
3. **仅窗口化/无边框** - 推荐使用无边框全屏模式

## 文件结构

```
lab/
├── build/bin/
│   └── fps_monitor.exe    # 主程序
├── src/
│   ├── main.cpp           # 入口和托盘
│   ├── etw_monitor.cpp/h  # ETW 帧率监控
│   └── overlay_window.cpp/h # 透明覆盖窗口
├── CMakeLists.txt
└── README.md
```

## 构建

```batch
cmake -B build -A x64
cmake --build build --config Release
```
