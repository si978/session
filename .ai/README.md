# AI Memory + Consistency (V1)

This repository uses **repo-first curated memory** and **deterministic context packs** to make multi-agent AI development auditable, consistent, and iteratable.

## Concepts
- Curated Memory (truth): `.ai/memory/**` (PR-only changes, validated by CI)
- Evidence: `.ai/evidence/**` (conversation transcripts, run logs, links)
- Context Pack (agent input): generated by `memctl build-pack` as `context_pack.json`
- Agent Report (agent output): `.ai/evidence/runs/*.agent_report.json`

## Contracts

### PR body (required when label `ai` is present)
- `Task ID: TASK-...`

### Agent report (required when label `ai` is present and enforcement=hard)
- Must include `context.pack_id` and `context.repo_commit`
- Must be reproducible: CI recomputes pack for `context.repo_commit` and must match `context.pack_id`

## Commands
- Validate memory: `python .ai/tools/memctl.py validate --commit HEAD`
- Stale check: `python .ai/tools/memctl.py check-stale --commit HEAD`
- Build pack: `python .ai/tools/memctl.py build-pack --commit HEAD --task-id TASK-... --out context_pack.json`
- Validate pack: `python .ai/tools/memctl.py validate-pack --pack context_pack.json --task-id TASK-...`

## Configuration
- `.ai/config.json` controls PR gate enforcement (`soft` -> warn, `hard` -> fail).

## Codex CLI Workflow (V1)
- 建一个 `TASK`（含 `pack.include_paths`）→ `build-pack` 得到 `context_pack.json` → 在 Codex CLI 里要求先读取该 pack 并“缺文件先提清单” → 提 PR 打 `ai` 标签并写 `Task ID: ...`。
- 可参考 `RUNBOOK-0001`：`.ai/memory/runbooks/RUNBOOK-0001-codex-cli-workflow/body.md`
